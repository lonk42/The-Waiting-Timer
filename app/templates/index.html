<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>{{ timer_name }} Timer</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center min-h-screen p-6">

  <h1 class="text-4xl font-bold mb-4">Total time waited for {{ timer_name }}</h1>
  <div id="total-time" class="text-6xl font-mono text-green-400 mb-8">
    {{ format_duration(total_seconds) }}
  </div>

  <div class="flex gap-4 mb-8">
    <button onclick="startTimer()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-xl">Start</button>
    <button onclick="stopTimer()" class="bg-red-600 hover:bg-red-700 px-6 py-3 rounded-xl">Stop</button>
  </div>

  {% if running %}
    <div class="mb-8 text-center">
      <h2 class="text-2xl mb-2">Running Timer</h2>
      <div id="running-timer" class="text-4xl font-mono text-yellow-400">00:00:00</div>
    </div>
  {% endif %}

  <h2 class="text-2xl font-semibold mb-4">Saved Timers</h2>
  <div id="timers" class="w-full max-w-3xl space-y-4">
    {% for t in timers %}
      <div class="bg-gray-800 p-4 rounded-xl flex justify-between items-center">
        <div>
          <p class="font-mono text-lg">{{ t.datetime }} | {{ format_duration(t.duration) }}</p>
          <input type="text" value="{{ t.description }}" 
                 onchange="updateDescription({{ t.id }}, this.value)"
                 class="bg-gray-700 mt-2 p-2 rounded w-80">
        </div>
      </div>
    {% endfor %}
  </div>

  <script>
    async function startTimer() {
      let res = await fetch("/start", {method: "POST"});
      let data = await res.json();
      if (data.status === "started") location.reload();
    }

    async function stopTimer() {
      let res = await fetch("/stop", {method: "POST"});
      let data = await res.json();
      if (data.id) location.reload();
    }

    async function updateDescription(id, description) {
      await fetch("/update_description", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({id, description})
      });
    }

    function formatDuration(seconds) {
      let hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
      let mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
      let secs = String(seconds % 60).padStart(2, '0');
      return `${hrs}:${mins}:${secs}`;
    }

    async function updateTotal() {
      let res = await fetch("/total");
      let data = await res.json();
      document.getElementById("total-time").textContent = formatDuration(data.total);
    }

    {% if running %}
    const startTime = {{ running }};
    function updateRunningTimer() {
      const now = Date.now() / 1000;
      let elapsed = Math.floor(now - startTime);
      document.getElementById("running-timer").textContent = formatDuration(elapsed);
    }
    setInterval(updateRunningTimer, 1000);
    updateRunningTimer();

    setInterval(updateTotal, 1000);
    updateTotal();
    {% endif %}
  </script>

</body>
</html>

